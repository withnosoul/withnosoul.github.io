(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{378:function(s,n,a){"use strict";a.r(n);var t=a(6),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[s._v("说明：这是常规安装nginx方式的教程，了解其基本使用即可。后续是在Docker内安装Nginx。")])]),s._v(" "),n("h2",{attrs:{id:"nginx安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装"}},[s._v("#")]),s._v(" nginx安装")]),s._v(" "),n("p",[s._v("主要参考该教程安装即可："),n("a",{attrs:{href:"https://www.runoob.com/linux/nginx-install-setup.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx安装配置"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"nginx常用功能及配件文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用功能及配件文件"}},[s._v("#")]),s._v(" nginx常用功能及配件文件")]),s._v(" "),n("p",[s._v("nginx配置文件结构请到页面 "),n("a",{attrs:{href:"https://www.runoob.com/w3cnote/nginx-setup-intro.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx配置文件结构"),n("OutboundLink")],1),s._v(" 查看。")]),s._v(" "),n("p",[s._v("配置文件目录："),n("code",[s._v("/usr/local/nginx/conf/nginx.conf")]),s._v("（前提是nginx是默认安装目录）。")]),s._v(" "),n("h3",{attrs:{id:"_1-反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-反向代理"}},[s._v("#")]),s._v(" 1.反向代理")]),s._v(" "),n("p",[s._v("nginx 负责将对 "),n("code",[s._v("192.168.0.107:80")]),s._v(" 的请求，转给 "),n("code",[s._v("http://127.0.0.1:8080")]),s._v("，而这个操作，浏览器并不知道，这就是反向代理。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen       80; // 监听port\n    server_name  192.168.0.107;  // 主机IP\n  \n    location / {\n        root   html;\n        proxy_pass  http://127.0.0.1:8080;\n        index  index.html index.htm;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   html;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"_2-负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-负载均衡"}},[s._v("#")]),s._v(" 2.负载均衡")]),s._v(" "),n("ol",[n("li",[s._v("轮询方式（默认）")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream myserver { // myserver 可以自己命名\n\t\tserver 192.168.0.107:8080;\n  \tserver 192.168.0.107:8081;\n}\n\nserver {·\n\t\tlisten \t\t\t80;\n    server_name\t192.168.0.107;\n    \n    location / {\n        root html;\n        proxy_pass http://myserver;\n        index index.html index.htm;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("weight")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream myserver {\n    server 192.168.0.107:8080 weight=5;\n    server 192.168.0.107:8081 weight=10; //weight值越大，权重越高，被分配的请求越多。\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("ip_hash\n每个请求按访问ip的hash结果分配，这样每个访客固定一个后端服务器。可以解决 session 的问题。")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream myserver {\n    ip_hash;\n    server 192.168.0.107:8080;\n    server 192.168.0.107:8081;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("fair（第三方）\n按后端服务器的响应时间来分配请求，响应时间短的优先分配。")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream myserver {\n    fair;\n    server 192.168.0.107:8080;\n    server 192.168.0.107:8081;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3-动静分离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-动静分离"}},[s._v("#")]),s._v(" 3.动静分离")]),s._v(" "),n("p",[s._v("严格意思上说应该是动态请求跟静态请求分开，可以理解成使用 Nginx 处理静态页面，Tomcat 处理动态页面。动静分离从目前实现角度来讲大致分为两种。 一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案。另外一种方法就是动态跟静态文件混合在一起发布，通过 Nginx 来分开。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location /www/ {\n    root  /data/;\n    index  index.html index.htm;\n}\n\nlocation /image/ {\n    root  /data/;\n    autoindex  on; // 显示目录索引\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"_4-高可用集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-高可用集群"}},[s._v("#")]),s._v(" 4.高可用集群")]),s._v(" "),n("p",[s._v("教程：详解 "),n("a",{attrs:{href:"http://www.zzvips.com/article/41615.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Keepalived+Nginx实现高可用（HA）"),n("OutboundLink")],1),s._v(" keepalived 配置文件，")]),s._v(" "),n("p",[s._v("目录："),n("code",[s._v("/etc/keepalived/keepalived.conf")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('global_defs {\n    lvs_id string\n\t\trouter_id nginx_01 # 标识本节点的名称，通常为hostname\n}\n\nvrrp_script chk_nginx {\n  \tscript "/etc/keepalived/nginx_check.sh" # 执行脚本\n  \tinterval 2 \t# 每2秒检测一次nginx的运行状态\n  \tweight -20 \t# 失败一次，将自己的优先级-20\n}\n\nvrrp_instance VI_1 {\n \t\tstate MASTER     # 状态，主节点为MASTER，备份节点为BACKUP\n\t\tinterface ens33    # 绑定VIP的网络接口，通过ifconfig查看自己的网络接口\n    # 虚拟路由的ID号,两个节点设置必须一样,可选IP最后一段使用,相同的VRID为一个组,\n    # 他将决定多播的MAC地址\n \t\tvirtual_router_id 51 \n\t\tmcast_src_ip 192.168.0.107 # 本机IP地址\n \t\tpriority 100     # 节点优先级，值范围0～254，MASTER要比BACKUP高\n \t\tadvert_int 1     # 组播信息发送时间间隔，两个节点必须设置一样，默认为1秒\n \t\tauthentication {\t# 设置验证信息，两个节点必须一致\n    \t\tauth_type PASS\n    \t\tauth_pass 1111\n \t\t}\n \t\tvirtual_ipaddress { # 虚拟IP，两个节点设置必须一样。可以设置多个，一行写一个\n  \t\t\t192.168.0.50\n \t\t}\n \n \t\ttrack_script {\n  \t\t\tchk_nginx # nginx存活状态检测脚本\n\t \t}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("p",[n("strong",[s._v("nginx 服务检测脚本")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#!/bin/bash\nA=`ps -C nginx --no-header | wc -l`\nif [ $A -eq 0 ];then\n\t/opt/nginx/sbin/nginx \t# 尝试重新启动nginx\n \tsleep 2 \t# 睡眠2秒\n \tif [ `ps -C nginx --no-header | wc -l` -eq 0 ];then\n  \tkillall keepalived \t# 启动失败，将keepalived服务杀死。将vip漂移到其它备份节点\n \tfi\nfi\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("启动keepalived服务："),n("code",[s._v("$ systemctl start keepalived.service")])]),s._v(" "),n("h2",{attrs:{id:"location字段详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location字段详解"}},[s._v("#")]),s._v(" location字段详解")]),s._v(" "),n("p",[s._v("参考文档："),n("a",{attrs:{href:"https://www.cnblogs.com/xiaoliangup/p/9175932.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx location指令详解"),n("OutboundLink")],1),s._v(" 。\n通过指定模式来与客户端请求的URL相匹配，基本语法如下："),n("code",[s._v("location [=|~|~*|^~|@] pattern {……}")])]),s._v(" "),n("ol",[n("li",[s._v("没有修饰符，表示：必须以指定模式开始；")]),s._v(" "),n("li",[s._v("= 表示：必须与指定的模式精确匹配；")]),s._v(" "),n("li",[s._v("~ 表示：指定的正则表达式要区分大小写；")]),s._v(" "),n("li",[s._v("~* 表示：指定的正则表达式不区分大小写；")]),s._v(" "),n("li",[s._v("^~ 类似于无修饰的行为，也是以指定模式开始，不同的是，如果匹配成功，那么就停止搜索其他模式了；")]),s._v(" "),n("li",[s._v("@ ：定义命名location区段，这些区段客户不能访问，只可以由内部产生的请求来访问，如try_files或error_page等。")])]),s._v(" "),n("p",[n("strong",[s._v("查找顺序和优先级")])]),s._v(" "),n("ol",[n("li",[s._v('带有"="的精确匹配优先')]),s._v(" "),n("li",[s._v("没有修饰符的精确匹配")]),s._v(" "),n("li",[s._v("正则表达式按照他们在配置文件中定义的顺序")]),s._v(" "),n("li",[s._v('带有"^~"修饰符的，开头匹配')]),s._v(" "),n("li",[s._v('带有"~"或"~*"修饰符的，如果正则表达式与URL匹配')]),s._v(" "),n("li",[s._v("没有修饰符的，如果指定字符串与URL开头匹配")])]),s._v(" "),n("p",[n("strong",[s._v("root、alias指令区别")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location /img/ {\n\talias\t/var/www/image/;\n}\n#若按照上述配置的话，则访问/img/目录里面的文件时，nginx会自动去/var/www/image/目录找文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location /img/ {\n\troot\t/var/www/image/;\n}\n#若按照这种配置的话，则访问/img/目录下文件时，nginx会去/var/www/image/img/目录下找文件。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("alias 是一个目录别名的定义，root则是最上层目录的定义。 还有一个重要的区别是alias后面必须要用“/”结束，\n否则会找不到文件的，而root则可有可无。")]),s._v(" "),n("h2",{attrs:{id:"操作命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#操作命令"}},[s._v("#")]),s._v(" 操作命令")]),s._v(" "),n("p",[n("strong",[s._v("问题：")]),s._v(" XShell可以访问内容，但是浏览器却访问不到内容，这时可能是防火墙的原因，请注意！ 下面命令可以解决问题。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 查看nginx服务是否已经启动\nps -ef | grep nginx\n\n# 然后查看80-端口是否被分配给了nginx\nnetstat -ntlp\n\n# 对80端口进行防火墙配置\nfirewall-cmd --zone=public --add-port=80/tcp --permanent\n\n# 重启防火墙服务\nsystemctl restart firewalld.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("strong",[s._v("nginx 服务相关命令：")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("进入目录 /usr/local/nginx/sbin\n\n# 启动nginx\n./nginx\n\n# 查看状态\nps -ef | grep nginx\n\n# 停止nginx\n./nginx -s stop\n\n# 重新加载\n./nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);