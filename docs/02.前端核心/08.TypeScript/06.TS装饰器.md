---
title: TS装饰器
date: 2022-07-28 00:17:00
permalink: /pages/71a516/
---


装饰器是一种特殊类型的声明，它能够被附加到类声明，方法，访问符，属性或参数上，可以修改类的行为。

装饰器使用`@expression`这种形式，expression 求值后必须为一个函数，他会在运行时被调用，被装饰的声明信息作为参数传入。

## 装饰器的执行时机
装饰器对类的行为的改变，是代码编译时发生的（不是TypeScript编译，而是js在执行机中编译阶段），而不是在运行时。

这意味着，装饰器能在编译阶段运行代码。也就是说，装饰器本质就是编译时执行的函数。

在Node.JS环境中模块一加载时就会执行。

## 函数柯里化解决参数问题
但是在实际场景中，有时希望像装饰器传入一些参数，如下：
```typescript
@path("/hello", "world")
class HelloService { }
```
此时上面的装饰器方法就不满足了（VSCode编译报错），这时我们可以借助JavaScript中函数柯里化特性。
```typescript
function Path(p1: string, p2: string) {
    return function (target) { //  这才是真正装饰器
        // do something 
    }
}
```


## 四种装饰器
### 1. 类装饰器
应用于类构造函数，其参数是类的构造函数。

注意： class并不是像Java那种强类型语言中的类，而是JavaScript构造函数的语法糖。

### 2. 方法装饰器
它会被应用到方法的 属性描述符上，可以用来监视，修改或者替换方法定义。

方法装饰会在运行时传入下列3个参数：
1. 对于静态成员来说是类的构造函数，对于实例成员来说是类的原型对象。 
2. 成员的名字。 
3. 成员的属性描述符。

### 3. 方法参数装饰器
参数装饰器表达式会在运行时当作函数被调用，传入下列3个参数：
1. 对于静态成员来说是类的构造函数，对于实例成员来说是类的原型对象。 
2. 方法名。 
3. 参数在函数参数列表中的索引。

### 4. 属性装饰器
属性装饰器表达式会在运行时当作函数被调用，传入下列2个参数：
1. 对于静态成员来说是类的构造函数，对于实例成员来说是类的原型对象。 
2. 成员的名字。

### 装饰器加载顺序
1. 有多个参数装饰器时，从最后一个参数装饰器依次向前执行。 
2. 方法和方法参数中参数参数装饰器先执行。 
3. 类装饰器总是最后执行。 
4. 方法和属性装饰器，谁在前面说先执行。因为参数属于方法一部分，所以参数会一直紧紧挨着方法执行。

> 第4点说明：如果属性在方法前面，那么执行顺序是：属性>参数>方法>类。 
> 如果方法在属性前面，那么执行顺序是：参数>方法>属性>类。


## 参考文档
1. [TypeScript装饰器（decorators）](https://www.cnblogs.com/winfred/p/8216650.html)
